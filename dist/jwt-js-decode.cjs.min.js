"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}function __awaiter(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,s)}u((n=n.apply(t,e||[])).next())})}function __generator(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,i&&(a=2&r[0]?i.return:r[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,i=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){u.label=r[1];break}if(6===r[0]&&u.label<a[1]){u.label=a[1],a=r;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(r);break}a[2]&&u.ops.pop(),u.trys.pop();continue}r=e.call(t,u)}catch(t){r=[6,t],i=0}finally{o=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,i,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s}function s2J(t){try{return JSON.parse(t)}catch(t){throw new Error(ILLEGAL_ARGUMENT)}}function b2s(t){try{if("object"==typeof window&&"function"==typeof window.atob)return window.atob(t);if("undefined"!=typeof Buffer)return new Buffer(t,"base64").toString("binary");throw new Error(ILLEGAL_ARGUMENT)}catch(t){throw new Error(t)}}function b2bu(t){if("string"!=typeof t||t.length%4!=0)throw new Error(ILLEGAL_ARGUMENT);return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function bu2b(t){if("string"!=typeof t||t.length%4==1)throw new Error(ILLEGAL_ARGUMENT);for(;t.length%4!=0;)t+="=";return t.replace(/\-/g,"+").replace(/_/g,"/")}function bu2s(t){return b2s(bu2b(t))}function isGzip(t){return"object"==typeof t&&"string"==typeof t.zip&&"GZIP"===t.zip.toUpperCase()}function jwtDecode(t){return new JwtDecode(t)}function jwtSplit(t){return new JwtSplit(t)}function s2b(t){try{if("object"==typeof window&&"function"==typeof window.atob)return window.btoa(t);if("undefined"!=typeof Buffer)return new Buffer(t).toString("base64");throw new Error(ILLEGAL_ARGUMENT)}catch(t){throw new Error(t)}}function s2bu(t){return b2bu(s2b(t))}function s2zbu(t){return s2bu(zip(t))}function unzip(t){if("string"!=typeof t)throw new Error(ILLEGAL_ARGUMENT);return pako.inflate(t,{raw:!1,from:"string",to:"string"})}function zbu2s(t){return unzip(bu2s(t))}function zip(t){if("string"!=typeof t)throw new Error(ILLEGAL_ARGUMENT);return pako.deflate(t,{raw:!1,from:"string",to:"string"})}function s2AB(t){for(var e=new Uint8Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}function AB2s(t){return t instanceof ArrayBuffer&&(t=new Uint8Array(t)),String.fromCharCode.apply(String,t)}function createHmac(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return webCryptoSubtle?(r=s2AB(e),[4,webCryptoSubtle.importKey("raw",r,{name:"HMAC",hash:{name:t}},!0,["sign"]).then(function(t){return{_key:t,update:function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,webCryptoSubtle.sign("HMAC",t,s2AB(e))];case 1:return[2,r.sent()]}})})}}})]):[3,2];case 1:return[2,n.sent()];case 2:return[2,crypto&&crypto.createHmac?Promise.resolve(crypto.createHmac(t.replace("SHA-","sha"),e)):Promise.reject(webCrypto)]}})})}function algHSsign(t){return function(e,r){return __awaiter(this,void 0,void 0,function(){var n,o,i,a,s,u,c;return __generator(this,function(p){switch(p.label){case 0:return[4,createHmac("SHA-"+t,r)];case 1:return n=p.sent(),i=(o=Promise).resolve,webCryptoSubtle?(s=s2bu,u=AB2s,c=n,c?[4,n.update(e)]:[3,3]):[3,4];case 2:c=p.sent(),p.label=3;case 3:return a=s.apply(void 0,[u.apply(void 0,[c])]),[3,5];case 4:a=b2bu(n&&n.update(e).digest("base64")),p.label=5;case 5:return[2,i.apply(o,[a])]}})})}}function algHSverify(t){return function(e,r,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return[4,algHSsign(t)(e,n)];case 1:return[2,o.sent()===r]}})})}}function algVerify(t,e,r,n){return __awaiter(this,void 0,void 0,function(){var o,i,a,s;return __generator(this,function(u){switch(u.label){case 0:if("string"!=typeof t||t.length<4)throw new Error(UNSUPPORTED_ALGORITHM);if("none"===(o=t.toLowerCase()))return[2,""===r];if(i=o.slice(0,2),a=parseInt(o.slice(2)),isNaN(a)||[256,384,512].indexOf(a)<0)throw new Error(UNSUPPORTED_ALGORITHM);switch(s=i){case"hs":return[3,1]}return[3,3];case 1:return[4,algHSverify(a)(e,r,n)];case 2:return[2,u.sent()];case 3:throw new Error(UNSUPPORTED_ALGORITHM)}})})}function algSign(t,e,r){return __awaiter(this,void 0,void 0,function(){var n,o,i,a;return __generator(this,function(s){switch(s.label){case 0:if("string"!=typeof t||t.length<4)throw new Error(UNSUPPORTED_ALGORITHM);if("none"===(n=t.toLowerCase()))return[2,""];if(o=n.slice(0,2),i=parseInt(n.slice(2)),isNaN(i)||[256,384,512].indexOf(i)<0)throw new Error(UNSUPPORTED_ALGORITHM);switch(a=o){case"hs":return[3,1]}return[3,3];case 1:return[4,algHSsign(i)(e,r)];case 2:return[2,s.sent()];case 3:throw new Error(UNSUPPORTED_ALGORITHM)}})})}function jwtVerify(t,e){return __awaiter(this,void 0,void 0,function(){var r,n,o;return __generator(this,function(i){switch(i.label){case 0:return r=jwtSplit(t),n=s2J(bu2s(r.header)),o=r.header+"."+r.payload,[4,algVerify(n.alg,o,r.signature,e)];case 1:return[2,i.sent()]}})})}function jwtSign(t,e){return __awaiter(this,void 0,void 0,function(){var r,n,o;return __generator(this,function(i){switch(i.label){case 0:return r=jwtSplit(t),n=s2J(bu2s(r.header)),o=r.header+"."+r.payload,[4,algSign(n.alg,o,e)];case 1:return[2,i.sent()]}})})}function resignJwt(t,e){return __awaiter(this,void 0,void 0,function(){var r,n,o,i;return __generator(this,function(a){switch(a.label){case 0:return r=jwtSplit(t),n=s2J(bu2s(r.header)),o=r.header+"."+r.payload,i=o+".",[4,algSign(n.alg,o,e)];case 1:return[2,i+a.sent()]}})})}function cryptoType(){return crypto?crypto.type||"crypto-node":"undefined"}Object.defineProperty(exports,"__esModule",{value:!0});var pako=_interopDefault(require("pako")),crypto=_interopDefault(require("crypto")),webCrypto="object"==typeof window&&(window.crypto||window.msCrypto),webCryptoSubtle=webCrypto&&(webCrypto.subtle||webCrypto.webkitSubtle||webCrypto.Subtle),UNSUPPORTED_ALGORITHM='Unsupported algorithm name specified! Supported algorithms: "HS256", "HS384", "HS512", "RS256", "RS384", "RS512" and "none".',ILLEGAL_ARGUMENT="Illegal argument specified!",JwtSplit=function(){function t(t){if("string"!=typeof t)throw new Error(ILLEGAL_ARGUMENT);var e=t.split(".");if(3!==e.length)throw new Error(ILLEGAL_ARGUMENT);var r=e[0],n=e[1],o=e[2];this.header=r,this.payload=n,this.signature=o}return t.prototype.toString=function(){return this.header+"."+this.payload+"."+this.signature},t}(),JwtDecode=function(){function t(t){if(this.header={},this.payload={},this.signature="","string"!=typeof t)throw new Error(ILLEGAL_ARGUMENT);var e=jwtSplit(t);e&&(this.header=e.header?s2J(bu2s(e.header)):{},this.payload=e.payload?s2J(isGzip(this.header)?zbu2s(e.payload):bu2s(e.payload)):{},this.signature=e.signature||"")}return t.prototype.toString=function(){return s2bu(JSON.stringify(this.header))+"."+(isGzip(this.header)?s2zbu(JSON.stringify(this.payload)):s2bu(JSON.stringify(this.payload)))+"."+this.signature},t}();exports.webCrypto=webCrypto,exports.webCryptoSubtle=webCryptoSubtle,exports.UNSUPPORTED_ALGORITHM=UNSUPPORTED_ALGORITHM,exports.ILLEGAL_ARGUMENT=ILLEGAL_ARGUMENT,exports.JwtSplit=JwtSplit,exports.JwtDecode=JwtDecode,exports.s2J=s2J,exports.b2s=b2s,exports.b2bu=b2bu,exports.bu2b=bu2b,exports.bu2s=bu2s,exports.isGzip=isGzip,exports.jwtDecode=jwtDecode,exports.jwtSplit=jwtSplit,exports.s2b=s2b,exports.s2bu=s2bu,exports.s2zbu=s2zbu,exports.unzip=unzip,exports.zbu2s=zbu2s,exports.zip=zip,exports.createHmac=createHmac,exports.algHSsign=algHSsign,exports.algHSverify=algHSverify,exports.algVerify=algVerify,exports.algSign=algSign,exports.jwtVerify=jwtVerify,exports.jwtSign=jwtSign,exports.resignJwt=resignJwt,exports.cryptoType=cryptoType;
